import jsPDF from "jspdf";
import autoTable from "jspdf-autotable";

export const generateFertilizerReport = (data) => {
    const doc = new jsPDF();

    // --- Page Border ---
    doc.setLineWidth(3);
    doc.setDrawColor(40, 167, 69); // Green color
    doc.rect(5, 5, 200, 287); // A4 size is 210x297mm

    // --- Title Section ---
    doc.setFontSize(22);
    doc.setTextColor(40, 167, 69); // Green color
    doc.text("Fasal Sarathi - Fertilizer Report", 105, 20, null, null, "center");

    // Subtitle / Date
    doc.setFontSize(12);
    doc.setTextColor(100);
    doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, null, null, "center");

    // Line separator
    doc.setLineWidth(0.5);
    doc.setDrawColor(200, 200, 200);
    doc.line(20, 35, 190, 35);

    // --- Description ---
    doc.setFontSize(11);
    doc.setTextColor(50);
    const description = "This report provides fertilizer recommendations based on the soil test details provided. Use this information to optimize crop yield and soil health.";
    doc.text(description, 20, 45, { maxWidth: 170 });

    // --- Input Parameters Section ---
    doc.setFontSize(14);
    doc.setTextColor(0);
    doc.text("Soil & Crop Details (Input)", 20, 60);

    const inputData = [
        ["Parameter", "Value"],
        ["Soil Type", data.soilType],
        ["Crop Type", data.cropType],
        ["Temperature", `${data.Temparature} Â°C`],
        ["Humidity", `${data.Humidity} %`],
        ["Moisture", `${data.Moisture} %`],
        ["Nitrogen (N)", `${data.PresentN} kg/ha`],
        ["Phosphorus (P)", `${data.PresentP} kg/ha`],
        ["Potassium (K)", `${data.PresentK} kg/ha`],
    ];

    autoTable(doc, {
        startY: 65,
        head: [inputData[0]],
        body: inputData.slice(1),
        theme: 'grid',
        headStyles: { fillColor: [40, 167, 69] },
        styles: { fontSize: 10 },
        margin: { left: 20 },
        tableWidth: 170,
    });

    // --- Recommendation Section ---
    const finalY = doc.lastAutoTable.finalY + 15;

    doc.setFontSize(14);
    doc.setTextColor(0);
    doc.text("Recommended Fertilizer", 20, finalY);

    doc.setDrawColor(40, 167, 69);
    doc.setFillColor(230, 255, 230); // Light green background
    doc.roundedRect(20, finalY + 5, 170, 30, 3, 3, 'FD');

    doc.setFontSize(12);
    doc.setTextColor(0);
    doc.text(`Fertilizer Name:`, 25, finalY + 15);
    doc.setFont("helvetica", "bold");
    doc.text(`${data.result.fertilizer_name}`, 65, finalY + 15);

    doc.setFont("helvetica", "normal");
    doc.text(`Quantity:`, 25, finalY + 25);
    doc.setFont("helvetica", "bold");
    doc.text(`${data.result.fertilizer_quantity} kg per acre`, 65, finalY + 25);

    // --- Suggestions Section ---
    const suggestionY = finalY + 45;
    doc.setFontSize(14);
    doc.setTextColor(0);
    doc.text("Suggestions", 20, suggestionY);

    doc.setFontSize(11);
    doc.setFont("helvetica", "normal");
    doc.setTextColor(50);

    const suggestions = [
        "1. Apply fertilizer in split doses for better absorption.",
        "2. Ensure proper irrigation after fertilizer application.",
        "3. Conduct regular soil testing to monitor nutrient levels.",
        "4. Use organic matter (compost/manure) to improve soil structure.",
        "5. Follow safety precautions while handling fertilizers."
    ];

    let currentY = suggestionY + 10;
    suggestions.forEach(suggestion => {
        doc.text(suggestion, 20, currentY);
        currentY += 7;
    });

    // --- Footer ---
    doc.setFontSize(10);
    doc.setTextColor(150);
    doc.text("Generated by Fasal Sarathi AI - Your Farming Companion", 105, 280, null, null, "center");

    // Save PDF
    doc.save("Fasal_Sarathi_Report.pdf");
};
